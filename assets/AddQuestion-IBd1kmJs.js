import{A as Tt,a1 as Et,_ as Qt,c as t,C as We,d as e,E as qt,F as Ct,H as y,M as n,O as Mt,Q as o,a2 as Ye,Z as d,I as l,G as a,J as O,N as u,V as de,T as se,a3 as Ze,K as h,Y as xe,$ as Lt,W as Dt,a4 as Ot,a5 as Xe}from"./index-BYaW2Sm3.js";import{g as Ft,e as be,d as Rt,b as Fe,f as Bt,h as Ht,i as Re,s as Se,j as $t,k as Vt,u as zt,l as Pt,m as Ut}from"./databaseService-C4AFskRA.js";var jt=o('<div class="loading-overlay svelte-1k8bvcn"><div class="spinner svelte-1k8bvcn"></div> Loading...</div>'),Gt=o('<p class="response-topics svelte-1k8bvcn"><small class="svelte-1k8bvcn"> </small></p>'),Jt=o('<li class="response-item-detail svelte-1k8bvcn"><p class="response-question svelte-1k8bvcn"><strong class="svelte-1k8bvcn">Q:</strong> </p> <p class="response-answer svelte-1k8bvcn"><strong class="svelte-1k8bvcn">A:</strong> </p> <!></li>'),Kt=o('<ul class="response-detail-list svelte-1k8bvcn"></ul>'),Wt=o('<p class="no-responses-msg svelte-1k8bvcn">No detailed answer history recorded for this user.</p>'),Yt=o('<div class="detail-modal-overlay svelte-1k8bvcn"><div class="detail-modal-content svelte-1k8bvcn"><button class="close-modal-button svelte-1k8bvcn" title="Close details">&times;</button> <h3 class="svelte-1k8bvcn"> </h3> <p><small> </small></p> <!></div></div>'),Zt=o('<p class="error-text svelte-1k8bvcn"> </p>'),Xt=o("<p>No submissions found for this survey yet, or no submissions with a final result.</p>"),It=o('<li class="svelte-1k8bvcn"><strong class="clickable-username svelte-1k8bvcn"> </strong> <br> <small class="svelte-1k8bvcn"> </small></li>'),es=o('<ul class="user-list svelte-1k8bvcn"></ul>'),ts=o("<p>No users achieved this result.</p>"),ss=o('<div class="result-group svelte-1k8bvcn"><h3 class="svelte-1k8bvcn"> <!>)</h3> <!></div>'),as=o("<p>Loading analysis data...</p>"),ls=o('<div class="analysis-view svelte-1k8bvcn"><button class="back-button svelte-1k8bvcn">← Back to Survey List</button> <h2 class="svelte-1k8bvcn"> </h2> <!></div>'),ns=o('<div class="survey-item svelte-1k8bvcn"><span class="survey-item-name svelte-1k8bvcn"> </span> <div class="survey-item-actions svelte-1k8bvcn"><button class="action-btn edit-btn svelte-1k8bvcn">Edit</button> <button class="action-btn analyze-btn svelte-1k8bvcn">Analyze</button> <button class="action-btn share-btn svelte-1k8bvcn" title="Copy survey link">Copy Link</button> <button class="action-btn delete-btn svelte-1k8bvcn">Delete</button></div></div>'),rs=o('<div class="existing-surveys-list svelte-1k8bvcn"><h3 class="svelte-1k8bvcn">Existing Surveys</h3> <!></div>'),is=o('<p class="no-surveys-msg svelte-1k8bvcn">No surveys created yet. Click "Create New Survey" to start.</p>'),os=o('<div class="survey-management svelte-1k8bvcn"><h2 class="svelte-1k8bvcn">Survey Management</h2> <button class="create-new-survey-btn svelte-1k8bvcn">+ Create New Survey</button> <!></div>'),vs=o('<div class="form-container survey-name-form svelte-1k8bvcn"><button class="back-button svelte-1k8bvcn">← Back to Survey List</button> <div class="form-section svelte-1k8bvcn"><h2 class="svelte-1k8bvcn">Step 1: Enter Survey Name</h2> <input type="text" placeholder="e.g., MBA vs MS Decision Aid" aria-label="Survey Name" class="svelte-1k8bvcn"> <button class="submit-btn svelte-1k8bvcn">Next: Add Topics</button></div></div>'),cs=o('<input type="text" class="svelte-1k8bvcn">'),us=o('<div class="form-container topics-form svelte-1k8bvcn"><button class="back-button svelte-1k8bvcn">← Back to Survey Name</button> <div class="form-section svelte-1k8bvcn"><h2 class="svelte-1k8bvcn"> </h2> <label for="numTopics" class="svelte-1k8bvcn">How many distinct outcome topics? (2-10)</label> <input type="number" id="numTopics" min="2" max="10" aria-label="Number of topics" class="svelte-1k8bvcn"> <!> <button class="submit-btn svelte-1k8bvcn">Next: Add Questions</button></div></div>'),ds=o('<div class="question-item svelte-1k8bvcn"><span class="question-item-text svelte-1k8bvcn"> </span> <div class="question-item-actions svelte-1k8bvcn"><button class="action-btn edit-btn svelte-1k8bvcn">Edit</button> <button class="action-btn delete-btn svelte-1k8bvcn">Delete</button></div></div>'),bs=o('<h3 class="svelte-1k8bvcn">Current Questions:</h3> <!>',1),fs=o('<p class="no-questions-msg svelte-1k8bvcn">No questions added yet for this survey.</p>'),ps=o('<div class="existing-questions-section svelte-1k8bvcn"><button class="add-question-btn svelte-1k8bvcn">+ Add New Question</button> <!></div>'),_s=o('<label class="checkbox-label svelte-1k8bvcn"><input type="checkbox" class="svelte-1k8bvcn"> </label>'),ms=o('<div class="option-config-item svelte-1k8bvcn"><h4 class="svelte-1k8bvcn"></h4> <div class="form-field svelte-1k8bvcn"><label class="svelte-1k8bvcn">Option Text:</label> <input type="text" class="svelte-1k8bvcn"></div> <div class="topic-association svelte-1k8bvcn"><p class="svelte-1k8bvcn">Associate with topics:</p> <!></div></div>'),ks=o('<div class="form-container add-edit-question-form svelte-1k8bvcn"><button class="back-button svelte-1k8bvcn">← Back to Question List</button> <h3 class="svelte-1k8bvcn"> </h3> <div class="form-field svelte-1k8bvcn"><label for="questionText" class="svelte-1k8bvcn">Question Text:</label> <input type="text" id="questionText" placeholder="Enter your question" class="svelte-1k8bvcn"></div> <div class="form-field svelte-1k8bvcn"><label for="numOptions" class="svelte-1k8bvcn">Number of answer options (2-10):</label> <input type="number" id="numOptions" min="2" max="10" class="svelte-1k8bvcn"></div> <!> <button class="submit-btn save-question-btn svelte-1k8bvcn"> </button></div>'),ys=o('<div class="question-management-view svelte-1k8bvcn"><button class="back-button svelte-1k8bvcn">← Back to Survey List</button> <h2 class="svelte-1k8bvcn"> </h2> <div class="survey-link-section svelte-1k8bvcn"><p>Share this survey link:</p> <div class="link-input-group svelte-1k8bvcn"><input type="text" readonly="" aria-label="Survey share link" class="svelte-1k8bvcn"> <button class="copy-btn svelte-1k8bvcn" title="Copy link">Copy</button></div></div> <!></div>'),hs=o('<main class="svelte-1k8bvcn"><!> <!> <!></main>');function xs(Ie,et){Tt(et,!1);const Be=Et(),Ae=()=>Ye(ke,"$areTopicsAdded",Be),tt=()=>Ye(ye,"$isSurveyNameAdded",Be);let $=d(""),C=d(2),v=d([]),ae=d(""),le=d(2),ne=d([]),Qe=d([]),qe=null,V=d(null),Y=d(!1),me=d([]),Z=d(!1),c=d(!1),ke=Ze(!1),ye=Ze(!1),he=d(!0),re=d(null),z=d(null),ie=d(!1),P=d(null),Le=d(""),oe=d(""),K=d(!1),A=d(null);Qt(async()=>{await Ce()});const Ce=async()=>{try{t(c,!0),t(Qe,await Ft()),t(c,!1)}catch(s){console.error("Error loading surveys:",s),t(c,!1)}},st=s=>{t(z,s.id),t(ae,s.question),t(le,s.buttons.length),t(ne,s.buttons.map(r=>{const F=new Array(e(v).length).fill(!1);return r.selectedTopics.forEach(x=>{const f=e(v).indexOf(x);f!==-1&&(F[f]=!0)}),{text:r.text,selectedTopics:F}})),t(Z,!0),t(re,s)},at=()=>{t(he,!1),t(Y,!1),ye.set(!1),ke.set(!1),t($,""),qe=null,t(V,null),t(C,2),De(),t(ie,!1),t(P,null),t(K,!1),t(A,null)},lt=async s=>{try{t(c,!0),t(V,s.id),qe=s.name,t($,s.name),t(Y,!0),t(he,!1),ye.set(!0),ke.set(!0),t(v,s.topics||[]),t(me,await Fe(e(V))),t(Z,!1),t(c,!1),t(ie,!1),t(P,null),t(K,!1),t(A,null)}catch(r){console.error("Error setting up survey for editing:",r),t(c,!1)}},nt=()=>{t(Z,!e(Z)),e(Z)?e(re)||(t(ae,""),t(z,null),Ne()):(t(re,null),t(z,null))},rt=async s=>{if(window.confirm(`Are you sure you want to delete the survey "${s.name}" and all its questions and user submissions? This action cannot be undone.`))try{t(c,!0),await Bt(s.id),await Ce(),e(V)===s.id&&e(ie)&&(t(ie,!1),t(P,null),t(K,!1),t(A,null)),t(c,!1)}catch(r){console.error("Error deleting survey:",r),t(c,!1)}},it=async s=>{if(window.confirm("Are you sure you want to delete this question?"))try{t(c,!0),await Ut(s),t(me,await Fe(e(V))),t(c,!1)}catch(r){console.error("Error deleting question:",r),t(c,!1)}},De=()=>{t(C,Math.max(2,Math.min(10,Number(e(C))||2))),t(v,new Array(e(C)).fill(""))},Ne=()=>{t(le,Math.max(2,Math.min(10,Number(e(le))||2)));const s=Array.isArray(e(v))?e(v).length:0;t(ne,Array(e(le)).fill().map(()=>({text:"",selectedTopics:new Array(s).fill(!1)})))},ot=()=>{if(!e($).trim()){alert("Please enter a survey name.");return}if(!e(Y)&&e(Qe).some(s=>s.name.toLowerCase()===e($).trim().toLowerCase())){alert("A survey with this name already exists. Please choose a different name.");return}ye.set(!0)},vt=async()=>{if(t(C,Math.max(2,Math.min(10,Number(e(C))||2))),e(v).length!==e(C))for(t(v,e(v).slice(0,e(C)));e(v).length<e(C);)e(v).push("");if(e(v).some(s=>!s.trim())){alert("Please enter all topic names.");return}if(new Set(e(v).map(s=>s.trim().toLowerCase())).size!==e(v).length){alert("Topic names must be unique.");return}try{t(c,!0);const s={name:e($).trim(),topics:e(v).map(r=>r.trim())};t(V,await Vt(s)),qe=e($).trim(),ke.set(!0),t(me,[]),Ne(),t(c,!1)}catch(s){console.error("Error creating survey with topics:",s),alert("Failed to create survey. Check console for details."),t(c,!1)}},ct=async()=>{if(!e(ae).trim()){alert("Please enter the question text.");return}if(e(ne).some(s=>!s.text.trim())){alert("Please enter text for all options.");return}if(e(ne).some(s=>!s.selectedTopics.some(r=>r))){alert("Each option must be associated with at least one topic.");return}try{t(c,!0);const s={question:e(ae).trim(),buttons:e(ne).map(r=>({text:r.text.trim(),selectedTopics:e(v).filter((F,x)=>r.selectedTopics[x])}))};e(z)?await zt(e(z),s):await Pt(e(V),s),t(me,await Fe(e(V))),t(ae,""),t(z,null),t(re,null),Ne(),t(Z,!1),t(c,!1)}catch(s){console.error(e(z)?"Error updating question:":"Error adding question:",s),alert("Failed to save question. Check console for details."),t(c,!1)}},ut=()=>{t(ae,""),t(z,null),t(re,null),t(Z,!1)},dt=()=>{t(C,Math.max(2,Math.min(10,Number(e(C))||2))),De()},bt=()=>{t(le,Math.max(2,Math.min(10,Number(e(le))||2))),Ne()},He=()=>{t(he,!0),t(Y,!1),ye.set(!1),ke.set(!1),qe=null,t(V,null),t(Z,!1),t(re,null),t(z,null),t(ie,!1),t(P,null),t(oe,""),t(K,!1),t(A,null),Ce()},ft=async s=>{t(c,!0),t(he,!1),t(ie,!0),t(Le,s.name),t(P,null),t(oe,""),t(K,!1),t(A,null);try{const r=await Ht(s.id);if(r.length===0)t(oe,"No submissions found for this survey yet."),t(P,{});else{const F=r.reduce((x,f)=>{var M;const N=f.finalResult||"N/A";return x[N]||(x[N]=[]),x[N].push({id:f.id,userName:f.userName,userEmail:f.userEmail,submittedAt:(M=f.submittedAt)!=null&&M.toDate?f.submittedAt.toDate().toLocaleString():new Date(f.submittedAt).toLocaleString(),answerHistory:f.answerHistory||[],finalResult:f.finalResult}),x},{});t(P,F)}}catch(r){console.error("Error fetching or processing survey submissions:",r),t(oe,"Failed to load analysis data. Please try again.")}finally{t(c,!1)}},pt=()=>{t(ie,!1),t(P,null),t(Le,""),t(oe,""),t(K,!1),t(A,null),t(he,!0),Ce()},_t=s=>{t(A,s),t(K,!0)},$e=()=>{t(K,!1),t(A,null)};We(()=>(Ae(),e(Y)),()=>{!Ae()&&!e(Y)&&De()}),We(()=>(e(v),Ae(),e(Y),e(re)),()=>{e(v).length>0&&(Ae()||e(Y))&&(e(re)||Ne())}),qt(),Ct();var Ve=hs(),ze=l(Ve);{var mt=s=>{var r=jt();n(s,r)};y(ze,s=>{e(c)&&s(mt)})}var Pe=a(ze,2);{var kt=s=>{var r=Yt(),F=l(r),x=l(F),f=a(x,2),N=l(f),M=a(f,2),ve=l(M),R=l(ve),U=a(M,2);{var T=p=>{var _=Kt();be(_,7,()=>e(A).answerHistory,(b,i)=>b.question+i,(b,i)=>{var m=Jt(),g=l(m),w=a(l(g)),E=a(g,2),j=a(l(E)),B=a(E,2);{var L=G=>{var D=Gt(),fe=l(D),J=l(fe);O(()=>h(J,`Selected Topic(s): ${e(i).topics.join(", ")??""}`)),n(G,D)};y(B,G=>{e(i).topics&&e(i).topics.length>0&&G(L)})}O(()=>{h(w,` ${e(i).question??""}`),h(j,` ${e(i).answer??""}`)}),n(b,m)}),n(p,_)},S=p=>{var _=Wt();n(p,_)};y(U,p=>{e(A).answerHistory&&e(A).answerHistory.length>0?p(T):p(S,!1)})}O(()=>{h(N,`Responses from: ${e(A).userName??""}`),h(R,`Email: ${e(A).userEmail??""} | Submitted: ${e(A).submittedAt??""}`)}),u("click",x,$e),u("click",r,Rt($e)),n(s,r)};y(Pe,s=>{e(K)&&e(A)&&s(kt)})}var yt=a(Pe,2);{var ht=s=>{var r=ls(),F=l(r),x=a(F,2),f=l(x),N=a(x,2);{var M=R=>{var U=Zt(),T=l(U);O(()=>h(T,e(oe))),n(R,U)},ve=R=>{var U=de(),T=se(U);{var S=_=>{var b=de(),i=se(b);{var m=w=>{var E=Xt();n(w,E)},g=w=>{var E=de(),j=se(E);be(j,1,()=>Object.entries(e(P)),Re,(B,L)=>{let G=()=>e(L)[0],D=()=>e(L)[1];var fe=ss(),J=l(fe),Q=l(J),X=a(Q);{var pe=k=>{var q=Dt("s");n(k,q)};y(X,k=>{D().length!==1&&k(pe)})}var ge=a(J,2);{var Te=k=>{var q=es();be(q,5,D,ce=>ce.id,(ce,H)=>{var I=It(),ee=l(I),W=l(ee),te=a(ee),ue=a(te,3),_e=l(ue);O(()=>{Se(ee,"title",`View ${e(H).userName??""}'s detailed responses`),h(W,e(H).userName),h(te,` (${e(H).userEmail??""}) `),h(_e,`Submitted: ${e(H).submittedAt??""}`)}),u("click",ee,()=>_t(e(H))),n(ce,I)}),n(k,q)},we=k=>{var q=ts();n(k,q)};y(ge,k=>{D().length>0?k(Te):k(we,!1)})}O(()=>h(Q,`Final Result: ${G()??""} (${D().length??""} user`)),n(B,fe)}),n(w,E)};y(i,w=>{Object.keys(e(P)).length===0&&!e(oe)?w(m):w(g,!1)})}n(_,b)},p=_=>{var b=de(),i=se(b);{var m=g=>{var w=as();n(g,w)};y(i,g=>{e(c)||g(m)},!0)}n(_,b)};y(T,_=>{e(P)?_(S):_(p,!1)},!0)}n(R,U)};y(N,R=>{e(oe)?R(M):R(ve,!1)})}O(()=>h(f,`Analysis for: ${e(Le)??""}`)),u("click",F,pt),n(s,r)},gt=s=>{var r=de(),F=se(r);{var x=N=>{var M=os(),ve=a(l(M),2),R=a(ve,2);{var U=S=>{var p=rs(),_=a(l(p),2);be(_,1,()=>e(Qe),b=>b.id,(b,i)=>{var m=ns(),g=l(m),w=l(g),E=a(g,2),j=l(E),B=a(j,2),L=a(B,2),G=a(L,2);O(()=>h(w,e(i).name)),u("click",j,()=>lt(e(i))),u("click",B,()=>ft(e(i))),u("click",L,()=>navigator.clipboard.writeText(`${window.location.origin}?survey=${e(i).id}`)),u("click",G,()=>rt(e(i))),n(b,m)}),n(S,p)},T=S=>{var p=de(),_=se(p);{var b=i=>{var m=is();n(i,m)};y(_,i=>{e(c)||i(b)},!0)}n(S,p)};y(R,S=>{e(Qe).length>0?S(U):S(T,!1)})}u("click",ve,at),n(N,M)},f=N=>{var M=de(),ve=se(M);{var R=T=>{var S=vs(),p=l(S),_=a(p,2),b=a(l(_),2),i=a(b,2);u("click",p,He),xe(b,()=>e($),m=>t($,m)),u("click",i,ot),n(T,S)},U=T=>{var S=de(),p=se(S);{var _=i=>{var m=us(),g=l(m),w=a(g,2),E=l(w),j=l(E),B=a(E,4),L=a(B,2);be(L,1,()=>e(v),Re,(D,fe,J)=>{var Q=cs();Se(Q,"placeholder",`Topic ${J+1} Name`),Se(Q,"aria-label",`Topic ${J+1} Name`),xe(Q,()=>e(v)[J],X=>Lt(v,e(v)[J]=X)),n(D,Q)});var G=a(L,2);O(()=>h(j,`Step 2: Define Topics for "${e($)??""}"`)),u("click",g,()=>{ye.set(!1),ke.set(!1),t($,"")}),xe(B,()=>e(C),D=>t(C,D)),u("input",B,dt),u("click",G,vt),n(i,m)},b=i=>{var m=ys(),g=l(m),w=a(g,2),E=l(w),j=a(w,2),B=a(l(j),2),L=l(B),G=a(L,2),D=a(j,2);{var fe=Q=>{var X=ps(),pe=l(X),ge=a(pe,2);{var Te=k=>{var q=bs(),ce=a(se(q),2);be(ce,1,()=>e(me),H=>H.id,(H,I)=>{var ee=ds(),W=l(ee),te=l(W),ue=a(W,2),_e=l(ue),Me=a(_e,2);O(()=>h(te,e(I).question)),u("click",_e,()=>st(e(I))),u("click",Me,()=>it(e(I).id)),n(H,ee)}),n(k,q)},we=k=>{var q=fs();n(k,q)};y(ge,k=>{e(me).length>0?k(Te):k(we,!1)})}u("click",pe,nt),n(Q,X)},J=Q=>{var X=ks(),pe=l(X),ge=a(pe,2),Te=l(ge),we=a(ge,2),k=a(l(we),2),q=a(we,2),ce=a(l(q),2),H=a(q,2);be(H,1,()=>e(ne),Re,(W,te,ue)=>{var _e=ms(),Me=l(_e);Me.textContent=`Option ${ue+1}`;var Ue=a(Me,2),je=l(Ue);Se(je,"for",`optionText-${ue}`);var Oe=a(je,2);Se(Oe,"id",`optionText-${ue}`),Se(Oe,"placeholder",`Answer Option ${ue+1}`);var wt=a(Ue,2),xt=a(l(wt),2);be(xt,3,()=>e(v),Ee=>Ee,(Ee,St,Ge)=>{var Je=_s(),Ke=l(Je),At=a(Ke);O(()=>h(At,` ${e(St)??""}`)),Ot(Ke,()=>e(te).selectedTopics[e(Ge)],Nt=>(e(te).selectedTopics[e(Ge)]=Nt,Xe(()=>e(ne)))),n(Ee,Je)}),xe(Oe,()=>e(te).text,Ee=>(e(te).text=Ee,Xe(()=>e(ne)))),n(W,_e)});var I=a(H,2),ee=l(I);O(()=>{h(Te,e(z)?"Edit Question":"Add a New Question"),h(ee,e(z)?"Update Question":"Save Question")}),u("click",pe,ut),xe(k,()=>e(ae),W=>t(ae,W)),xe(ce,()=>e(le),W=>t(le,W)),u("input",ce,bt),u("click",I,ct),n(Q,X)};y(D,Q=>{e(Z)?Q(J,!1):Q(fe)})}O(()=>{h(E,`Managing Questions for: ${e($)??""}`),$t(L,`${window.location.origin}?survey=${e(V)}`)}),u("click",g,He),u("click",G,()=>navigator.clipboard.writeText(`${window.location.origin}?survey=${e(V)}`)),n(i,m)};y(p,i=>{!Ae()&&!e(Y)?i(_):i(b,!1)},!0)}n(T,S)};y(ve,T=>{tt()?T(U,!1):T(R)},!0)}n(N,M)};y(F,N=>{e(he)?N(x):N(f,!1)},!0)}n(s,r)};y(yt,s=>{e(ie)&&!e(K)?s(ht):s(gt,!1)})}n(Ie,Ve),Mt()}export{xs as default};
