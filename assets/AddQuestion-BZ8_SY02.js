import{A as xt,a1 as wt,_ as kt,c as t,C as Ue,d as e,E as St,F as At,H as _,M as l,O as Nt,Q as i,a2 as Ge,Z as d,I as o,G as a,J as R,N as h,V as le,T as Z,a3 as Je,K as N,Y as ge,$ as Tt,W as Et,a4 as Qt,a5 as Ke}from"./index-BDuR2JEX.js";import{g as qt,e as ce,b as De,d as Ct,f as Mt,i as Ce,s as Ne,h as Lt,j as Ot,u as Dt,k as Ft,l as Bt}from"./databaseService-BS34ChEq.js";var zt=i('<div class="loading-overlay svelte-121oveh"><div class="spinner svelte-121oveh"></div> Loading...</div>'),Pt=i('<p class="error-text svelte-121oveh"> </p>'),$t=i("<p>No submissions found for this survey yet, or no submissions with a final result.</p>"),Ht=i('<li class="svelte-121oveh"><strong class="svelte-121oveh"> </strong> <br> <small class="svelte-121oveh"> </small></li>'),Rt=i('<ul class="user-list svelte-121oveh"></ul>'),Vt=i("<p>No users achieved this result.</p>"),jt=i('<div class="result-group svelte-121oveh"><h3 class="svelte-121oveh"> <!>)</h3> <!></div>'),Ut=i("<p>Loading analysis data...</p>"),Gt=i('<div class="analysis-view svelte-121oveh"><button class="back-button svelte-121oveh">← Back to Survey List</button> <h2 class="svelte-121oveh"> </h2> <!></div>'),Jt=i('<div class="survey-item svelte-121oveh"><span class="survey-item-name svelte-121oveh"> </span> <div class="survey-item-actions svelte-121oveh"><button class="action-btn edit-btn svelte-121oveh">Edit</button> <button class="action-btn analyze-btn svelte-121oveh">Analyze</button> <button class="action-btn share-btn svelte-121oveh" title="Copy survey link">Copy Link</button> <button class="action-btn delete-btn svelte-121oveh">Delete</button></div></div>'),Kt=i('<div class="existing-surveys-list svelte-121oveh"><h3 class="svelte-121oveh">Existing Surveys</h3> <!></div>'),Wt=i('<p class="no-surveys-msg svelte-121oveh">No surveys created yet. Click "Create New Survey" to start.</p>'),Yt=i('<div class="survey-management svelte-121oveh"><h2 class="svelte-121oveh">Survey Management</h2> <button class="create-new-survey-btn svelte-121oveh">+ Create New Survey</button> <!></div>'),Zt=i('<div class="form-container survey-name-form svelte-121oveh"><button class="back-button svelte-121oveh">← Back to Survey List</button> <div class="form-section svelte-121oveh"><h2 class="svelte-121oveh">Step 1: Enter Survey Name</h2> <input type="text" placeholder="e.g., MBA vs MS Decision Aid" aria-label="Survey Name" class="svelte-121oveh"> <button class="submit-btn svelte-121oveh">Next: Add Topics</button></div></div>'),Xt=i('<input type="text" class="svelte-121oveh">'),It=i('<div class="form-container topics-form svelte-121oveh"><button class="back-button svelte-121oveh">← Back to Survey Name</button> <div class="form-section svelte-121oveh"><h2 class="svelte-121oveh"> </h2> <label for="numTopics" class="svelte-121oveh">How many distinct outcome topics? (2-10)</label> <input type="number" id="numTopics" min="2" max="10" aria-label="Number of topics" class="svelte-121oveh"> <!> <button class="submit-btn svelte-121oveh">Next: Add Questions</button></div></div>'),es=i('<div class="question-item svelte-121oveh"><span class="question-item-text svelte-121oveh"> </span> <div class="question-item-actions svelte-121oveh"><button class="action-btn edit-btn svelte-121oveh">Edit</button> <button class="action-btn delete-btn svelte-121oveh">Delete</button></div></div>'),ts=i('<h3 class="svelte-121oveh">Current Questions:</h3> <!>',1),ss=i('<p class="no-questions-msg svelte-121oveh">No questions added yet for this survey.</p>'),as=i('<div class="existing-questions-section svelte-121oveh"><button class="add-question-btn svelte-121oveh">+ Add New Question</button> <!></div>'),os=i('<label class="checkbox-label svelte-121oveh"><input type="checkbox" class="svelte-121oveh"> </label>'),ls=i('<div class="option-config-item svelte-121oveh"><h4 class="svelte-121oveh"></h4> <div class="form-field svelte-121oveh"><label class="svelte-121oveh">Option Text:</label> <input type="text" class="svelte-121oveh"></div> <div class="topic-association svelte-121oveh"><p class="svelte-121oveh">Associate with topics:</p> <!></div></div>'),rs=i('<div class="form-container add-edit-question-form svelte-121oveh"><button class="back-button svelte-121oveh">← Back to Question List</button> <h3 class="svelte-121oveh"> </h3> <div class="form-field svelte-121oveh"><label for="questionText" class="svelte-121oveh">Question Text:</label> <input type="text" id="questionText" placeholder="Enter your question" class="svelte-121oveh"></div> <div class="form-field svelte-121oveh"><label for="numOptions" class="svelte-121oveh">Number of answer options (2-10):</label> <input type="number" id="numOptions" min="2" max="10" class="svelte-121oveh"></div> <!> <button class="submit-btn save-question-btn svelte-121oveh"> </button></div>'),is=i('<div class="question-management-view svelte-121oveh"><button class="back-button svelte-121oveh">← Back to Survey List</button> <h2 class="svelte-121oveh"> </h2> <div class="survey-link-section svelte-121oveh"><p>Share this survey link:</p> <div class="link-input-group svelte-121oveh"><input type="text" readonly="" aria-label="Survey share link" class="svelte-121oveh"> <button class="copy-btn svelte-121oveh" title="Copy link">Copy</button></div></div> <!></div>'),ns=i('<main class="svelte-121oveh"><!> <!></main>');function cs(We,Ye){xt(Ye,!1);const Fe=wt(),xe=()=>Ge(he,"$areTopicsAdded",Fe),Ze=()=>Ge(fe,"$isSurveyNameAdded",Fe);let q=d(""),k=d(2),v=d([]),X=d(""),I=d(2),ee=d([]),Te=d([]),Ee=null,C=d(null),V=d(!1),de=d([]),j=d(!1),n=d(!1),he=Je(!1),fe=Je(!1),me=d(!0),te=d(null),M=d(null),se=d(!1),L=d(null),Me=d(""),ae=d("");kt(async()=>{await Qe()});const Qe=async()=>{try{t(n,!0),t(Te,await qt()),t(n,!1)}catch(s){console.error("Error loading surveys:",s),t(n,!1)}},Xe=s=>{t(M,s.id),t(X,s.question),t(I,s.buttons.length),t(ee,s.buttons.map(r=>{const F=new Array(e(v).length).fill(!1);return r.selectedTopics.forEach(S=>{const A=e(v).indexOf(S);A!==-1&&(F[A]=!0)}),{text:r.text,selectedTopics:F}})),t(j,!0),t(te,s)},Ie=()=>{t(me,!1),t(V,!1),fe.set(!1),he.set(!1),t(q,""),Ee=null,t(C,null),t(k,2),Le(),t(se,!1),t(L,null)},et=async s=>{try{t(n,!0),t(C,s.id),Ee=s.name,t(q,s.name),t(V,!0),t(me,!1),fe.set(!0),he.set(!0),t(v,s.topics||[]),t(de,await De(e(C))),t(j,!1),t(n,!1),t(se,!1),t(L,null)}catch(r){console.error("Error setting up survey for editing:",r),t(n,!1)}},tt=()=>{t(j,!e(j)),e(j)?e(te)||(t(X,""),t(M,null),we()):(t(te,null),t(M,null))},st=async s=>{if(window.confirm(`Are you sure you want to delete the survey "${s.name}" and all its questions and user submissions? This action cannot be undone.`))try{t(n,!0),await Ct(s.id),await Qe(),e(C)===s.id&&e(se)&&(t(se,!1),t(L,null)),t(n,!1)}catch(r){console.error("Error deleting survey:",r),t(n,!1)}},at=async s=>{if(window.confirm("Are you sure you want to delete this question?"))try{t(n,!0),await Bt(s),t(de,await De(e(C))),t(n,!1)}catch(r){console.error("Error deleting question:",r),t(n,!1)}},Le=()=>{t(k,Math.max(2,Math.min(10,Number(e(k))||2))),t(v,new Array(e(k)).fill(""))},we=()=>{t(I,Math.max(2,Math.min(10,Number(e(I))||2))),t(ee,Array(e(I)).fill().map(()=>({text:"",selectedTopics:new Array(e(v).length).fill(!1)})))},ot=()=>{if(!e(q).trim()){alert("Please enter a survey name.");return}if(!e(V)&&e(Te).some(s=>s.name.toLowerCase()===e(q).trim().toLowerCase())){alert("A survey with this name already exists. Please choose a different name.");return}fe.set(!0)},lt=async()=>{if(t(k,Math.max(2,Math.min(10,Number(e(k))||2))),e(v).length!==e(k))for(t(v,e(v).slice(0,e(k)));e(v).length<e(k);)e(v).push("");if(e(v).some(s=>!s.trim())){alert("Please enter all topic names.");return}if(new Set(e(v).map(s=>s.trim().toLowerCase())).size!==e(v).length){alert("Topic names must be unique.");return}try{t(n,!0);const s={name:e(q).trim(),topics:e(v).map(r=>r.trim())};t(C,await Ot(s)),Ee=e(q).trim(),he.set(!0),t(de,[]),we(),t(n,!1)}catch(s){console.error("Error creating survey with topics:",s),alert("Failed to create survey. Check console for details."),t(n,!1)}},rt=async()=>{if(!e(X).trim()){alert("Please enter the question text.");return}if(e(ee).some(s=>!s.text.trim())){alert("Please enter text for all options.");return}if(e(ee).some(s=>!s.selectedTopics.some(r=>r))){alert("Each option must be associated with at least one topic.");return}try{t(n,!0);const s={question:e(X).trim(),buttons:e(ee).map(r=>({text:r.text.trim(),selectedTopics:e(v).filter((F,S)=>r.selectedTopics[S])}))};e(M)?await Dt(e(M),s):await Ft(e(C),s),t(de,await De(e(C))),t(X,""),t(M,null),t(te,null),we(),t(j,!1),t(n,!1)}catch(s){console.error(e(M)?"Error updating question:":"Error adding question:",s),alert("Failed to save question. Check console for details."),t(n,!1)}},it=()=>{t(X,""),t(M,null),t(te,null),t(j,!1)},nt=()=>{t(k,Math.max(2,Math.min(10,Number(e(k))||2))),Le()},vt=()=>{t(I,Math.max(2,Math.min(10,Number(e(I))||2))),we()},Be=()=>{t(me,!0),t(V,!1),fe.set(!1),he.set(!1),Ee=null,t(C,null),t(j,!1),t(te,null),t(M,null),t(se,!1),t(L,null),t(ae,""),Qe()},ut=async s=>{t(n,!0),t(me,!1),t(se,!0),t(Me,s.name),t(L,null),t(ae,"");try{const r=await Mt(s.id);if(r.length===0)t(ae,"No submissions found for this survey yet."),t(L,{});else{const F=r.reduce((S,A)=>{const T=A.finalResult||"N/A";return S[T]||(S[T]=[]),S[T].push({userName:A.userName,userEmail:A.userEmail,submittedAt:A.submittedAt.toDate?A.submittedAt.toDate().toLocaleString():new Date(A.submittedAt).toLocaleString()}),S},{});t(L,F)}}catch(r){console.error("Error fetching or processing survey submissions:",r),t(ae,"Failed to load analysis data. Please try again.")}finally{t(n,!1)}},ct=()=>{t(se,!1),t(L,null),t(Me,""),t(ae,""),t(me,!0),Qe()};Ue(()=>(xe(),e(V)),()=>{!xe()&&!e(V)&&Le()}),Ue(()=>(e(v),xe(),e(V),e(te)),()=>{e(v).length>0&&(xe()||e(V))&&(e(te)||we())}),St(),At();var ze=ns(),Pe=o(ze);{var dt=s=>{var r=zt();l(s,r)};_(Pe,s=>{e(n)&&s(dt)})}var ht=a(Pe,2);{var ft=s=>{var r=Gt(),F=o(r),S=a(F,2),A=o(S),T=a(S,2);{var re=B=>{var U=Pt(),E=o(U);R(()=>N(E,e(ae))),l(B,U)},pe=B=>{var U=le(),E=Z(U);{var b=y=>{var f=le(),u=Z(f);{var m=p=>{var O=$t();l(p,O)},g=p=>{var O=le(),G=Z(O);ce(G,1,()=>Object.entries(e(L)),Ce,(z,D)=>{let ie=()=>e(D)[0],P=()=>e(D)[1];var ke=jt(),J=o(ke),x=o(J),K=a(x);{var ne=c=>{var w=Et("s");l(c,w)};_(K,c=>{P().length!==1&&c(ne)})}var _e=a(J,2);{var Se=c=>{var w=Rt();ce(w,5,P,Ce,(ye,$)=>{var W=Ht(),ve=o(W),H=o(ve),Y=a(ve),oe=a(Y,3),ue=o(oe);R(()=>{N(H,e($).userName),N(Y,` (${e($).userEmail??""}) `),N(ue,`Submitted: ${e($).submittedAt??""}`)}),l(ye,W)}),l(c,w)},be=c=>{var w=Vt();l(c,w)};_(_e,c=>{P().length>0?c(Se):c(be,!1)})}R(()=>N(x,`Final Result: ${ie()??""} (${P().length??""} user`)),l(z,ke)}),l(p,O)};_(u,p=>{Object.keys(e(L)).length===0&&!e(ae)?p(m):p(g,!1)})}l(y,f)},Q=y=>{var f=le(),u=Z(f);{var m=g=>{var p=Ut();l(g,p)};_(u,g=>{e(n)||g(m)},!0)}l(y,f)};_(E,y=>{e(L)?y(b):y(Q,!1)},!0)}l(B,U)};_(T,B=>{e(ae)?B(re):B(pe,!1)})}R(()=>N(A,`Analysis for: ${e(Me)??""}`)),h("click",F,ct),l(s,r)},mt=s=>{var r=le(),F=Z(r);{var S=T=>{var re=Yt(),pe=a(o(re),2),B=a(pe,2);{var U=b=>{var Q=Kt(),y=a(o(Q),2);ce(y,1,()=>e(Te),f=>f.id,(f,u)=>{var m=Jt(),g=o(m),p=o(g),O=a(g,2),G=o(O),z=a(G,2),D=a(z,2),ie=a(D,2);R(()=>N(p,e(u).name)),h("click",G,()=>et(e(u))),h("click",z,()=>ut(e(u))),h("click",D,()=>navigator.clipboard.writeText(`${window.location.origin}?survey=${e(u).id}`)),h("click",ie,()=>st(e(u))),l(f,m)}),l(b,Q)},E=b=>{var Q=le(),y=Z(Q);{var f=u=>{var m=Wt();l(u,m)};_(y,u=>{e(n)||u(f)},!0)}l(b,Q)};_(B,b=>{e(Te).length>0?b(U):b(E,!1)})}h("click",pe,Ie),l(T,re)},A=T=>{var re=le(),pe=Z(re);{var B=E=>{var b=Zt(),Q=o(b),y=a(Q,2),f=a(o(y),2),u=a(f,2);h("click",Q,Be),ge(f,()=>e(q),m=>t(q,m)),h("click",u,ot),l(E,b)},U=E=>{var b=le(),Q=Z(b);{var y=u=>{var m=It(),g=o(m),p=a(g,2),O=o(p),G=o(O),z=a(O,4),D=a(z,2);ce(D,1,()=>e(v),Ce,(P,ke,J)=>{var x=Xt();Ne(x,"placeholder",`Topic ${J+1} Name`),Ne(x,"aria-label",`Topic ${J+1} Name`),ge(x,()=>e(v)[J],K=>Tt(v,e(v)[J]=K)),l(P,x)});var ie=a(D,2);R(()=>N(G,`Step 2: Define Topics for "${e(q)??""}"`)),h("click",g,()=>{fe.set(!1),he.set(!1),t(q,"")}),ge(z,()=>e(k),P=>t(k,P)),h("input",z,nt),h("click",ie,lt),l(u,m)},f=u=>{var m=is(),g=o(m),p=a(g,2),O=o(p),G=a(p,2),z=a(o(G),2),D=o(z),ie=a(D,2),P=a(G,2);{var ke=x=>{var K=as(),ne=o(K),_e=a(ne,2);{var Se=c=>{var w=ts(),ye=a(Z(w),2);ce(ye,1,()=>e(de),$=>$.id,($,W)=>{var ve=es(),H=o(ve),Y=o(H),oe=a(H,2),ue=o(oe),qe=a(ue,2);R(()=>N(Y,e(W).question)),h("click",ue,()=>Xe(e(W))),h("click",qe,()=>at(e(W).id)),l($,ve)}),l(c,w)},be=c=>{var w=ss();l(c,w)};_(_e,c=>{e(de).length>0?c(Se):c(be,!1)})}h("click",ne,tt),l(x,K)},J=x=>{var K=rs(),ne=o(K),_e=a(ne,2),Se=o(_e),be=a(_e,2),c=a(o(be),2),w=a(be,2),ye=a(o(w),2),$=a(w,2);ce($,1,()=>e(ee),Ce,(H,Y,oe)=>{var ue=ls(),qe=o(ue);qe.textContent=`Option ${oe+1}`;var $e=a(qe,2),He=o($e);Ne(He,"for",`optionText-${oe}`);var Oe=a(He,2);Ne(Oe,"id",`optionText-${oe}`),Ne(Oe,"placeholder",`Answer Option ${oe+1}`);var pt=a($e,2),_t=a(o(pt),2);ce(_t,3,()=>e(v),Ae=>Ae,(Ae,bt,Re)=>{var Ve=os(),je=o(Ve),yt=a(je);R(()=>N(yt,` ${e(bt)??""}`)),Qt(je,()=>e(Y).selectedTopics[e(Re)],gt=>(e(Y).selectedTopics[e(Re)]=gt,Ke(()=>e(ee)))),l(Ae,Ve)}),ge(Oe,()=>e(Y).text,Ae=>(e(Y).text=Ae,Ke(()=>e(ee)))),l(H,ue)});var W=a($,2),ve=o(W);R(()=>{N(Se,e(M)?"Edit Question":"Add a New Question"),N(ve,e(M)?"Update Question":"Save Question")}),h("click",ne,it),ge(c,()=>e(X),H=>t(X,H)),ge(ye,()=>e(I),H=>t(I,H)),h("input",ye,vt),h("click",W,rt),l(x,K)};_(P,x=>{e(j)?x(J,!1):x(ke)})}R(()=>{N(O,`Managing Questions for: ${e(q)??""}`),Lt(D,`${window.location.origin}?survey=${e(C)}`)}),h("click",g,Be),h("click",ie,()=>navigator.clipboard.writeText(`${window.location.origin}?survey=${e(C)}`)),l(u,m)};_(Q,u=>{!xe()&&!e(V)?u(y):u(f,!1)},!0)}l(E,b)};_(pe,E=>{Ze()?E(U,!1):E(B)},!0)}l(T,re)};_(F,T=>{e(me)?T(S):T(A,!1)},!0)}l(s,r)};_(ht,s=>{e(se)?s(ft):s(mt,!1)})}l(We,ze),Nt()}export{cs as default};
