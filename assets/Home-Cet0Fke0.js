import{S as fe,o as Te,a as De,s as se,b as Le,c as r,U as G,g as de,d as e,e as be,f as Ue,h as Me,i as Fe,j as Ce,p as Ye,L as Be,B as He,R as Qe,k as Pe,l as $e,P as ze,m as Ge,n as Ke,u as je,q as Ie,r as ce,t as Ve,v as Ze,w as Je,x as We,y as Xe,z as et,A as we,C as tt,D as ke,E as rt,F as Se,G as g,H as M,I as o,J as K,K as L,M as d,N as ne,O as xe,Q as k,T as te,V as le,W as ye,X as at,Y as Ne,Z as H,_ as st,$ as Ee,a0 as nt}from"./index-BYaW2Sm3.js";import{e as ue,s as lt,i as pe,p as it,g as vt,a as ot,b as ut,c as ct}from"./databaseService-C4AFskRA.js";function ie(y,S=null,x){if(typeof y!="object"||y===null||fe in y)return y;const P=Me(y);if(P!==Te&&P!==De)return y;var f=new Map,p=Fe(y),j=se(0);p&&f.set("length",se(y.length));var E;return new Proxy(y,{defineProperty(n,t,a){(!("value"in a)||a.configurable===!1||a.enumerable===!1||a.writable===!1)&&Le();var i=f.get(t);return i===void 0?(i=se(a.value),f.set(t,i)):r(i,ie(a.value,E)),!0},deleteProperty(n,t){var a=f.get(t);if(a===void 0)t in n&&f.set(t,se(G));else{if(p&&typeof t=="string"){var i=f.get("length"),s=Number(t);Number.isInteger(s)&&s<i.v&&r(i,s)}r(a,G),Oe(j)}return!0},get(n,t,a){var O;if(t===fe)return y;var i=f.get(t),s=t in n;if(i===void 0&&(!s||(O=de(n,t))!=null&&O.writable)&&(i=se(ie(s?n[t]:G,E)),f.set(t,i)),i!==void 0){var m=e(i);return m===G?void 0:m}return Reflect.get(n,t,a)},getOwnPropertyDescriptor(n,t){var a=Reflect.getOwnPropertyDescriptor(n,t);if(a&&"value"in a){var i=f.get(t);i&&(a.value=e(i))}else if(a===void 0){var s=f.get(t),m=s==null?void 0:s.v;if(s!==void 0&&m!==G)return{enumerable:!0,configurable:!0,value:m,writable:!0}}return a},has(n,t){var m;if(t===fe)return!0;var a=f.get(t),i=a!==void 0&&a.v!==G||Reflect.has(n,t);if(a!==void 0||be!==null&&(!i||(m=de(n,t))!=null&&m.writable)){a===void 0&&(a=se(i?ie(n[t],E):G),f.set(t,a));var s=e(a);if(s===G)return!1}return i},set(n,t,a,i){var w;var s=f.get(t),m=t in n;if(p&&t==="length")for(var O=a;O<s.v;O+=1){var F=f.get(O+"");F!==void 0?r(F,G):O in n&&(F=se(G),f.set(O+"",F))}s===void 0?(!m||(w=de(n,t))!=null&&w.writable)&&(s=se(void 0),r(s,ie(a,E)),f.set(t,s)):(m=s.v!==G,r(s,ie(a,E)));var D=Reflect.getOwnPropertyDescriptor(n,t);if(D!=null&&D.set&&D.set.call(i,a),!m){if(p&&typeof t=="string"){var I=f.get("length"),b=Number(t);Number.isInteger(b)&&b>=I.v&&r(I,b+1)}Oe(j)}return!0},ownKeys(n){e(j);var t=Reflect.ownKeys(n).filter(s=>{var m=f.get(s);return m===void 0||m.v!==G});for(var[a,i]of f)i.v!==G&&!(a in n)&&t.push(a);return t},setPrototypeOf(){Ue()}})}function Oe(y,S=1){r(y,y.v+S)}function qe(y){for(var S=be,x=be;S!==null&&!(S.f&(He|Qe));)S=S.parent;try{return Pe(S),y()}finally{Pe(x)}}function oe(y,S,x,P){var Z;var f=(x&Je)!==0,p=!$e||(x&ze)!==0,j=(x&Ge)!==0,E=(x&We)!==0,n=!1,t;j?[t,n]=Ce(()=>y[S]):t=y[S];var a=fe in y||Ke in y,i=((Z=de(y,S))==null?void 0:Z.set)??(a&&j&&S in y?u=>y[S]=u:void 0),s=P,m=!0,O=!1,F=()=>(O=!0,m&&(m=!1,E?s=je(P):s=P),s);t===void 0&&P!==void 0&&(i&&p&&Ye(),t=F(),i&&i(t));var D;if(p)D=()=>{var u=y[S];return u===void 0?F():(m=!0,O=!1,u)};else{var I=qe(()=>(f?Ie:ce)(()=>y[S]));I.f|=Be,D=()=>{var u=e(I);return u!==void 0&&(s=void 0),u===void 0?s:u}}if(!(x&Ve))return D;if(i){var b=y.$$legacy;return function(u,c){return arguments.length>0?((!p||!c||b||n)&&i(c?D():u),u):D()}}var w=!1,_=!1,T=Xe(t),C=qe(()=>Ie(()=>{var u=D(),c=e(T);return w?(w=!1,_=!0,c):(_=!1,T.v=u)}));return f||(C.equals=Ze),function(u,c){if(et!==null&&(w=_,D(),e(T)),arguments.length>0){const q=c?e(C):p&&j?ie(u):u;return C.equals(q)||(w=!0,r(T,q),O&&s!==void 0&&(s=q),je(()=>e(C))),u}return e(C)}}var ft=k('<p class="svelte-1ygypf7">You are most suited for <strong class="svelte-1ygypf7"> </strong></p>'),dt=k('<strong class="svelte-1ygypf7"> </strong> and <strong class="svelte-1ygypf7"> </strong>',1),yt=k('<strong class="svelte-1ygypf7"> </strong><!><!>',1),_t=k('<p class="svelte-1ygypf7">You are equally suited for <!></p>'),gt=k('<h2 class="svelte-1ygypf7">Conclusion</h2> <!>',1),mt=k('<li class="svelte-1ygypf7"><p class="question-text svelte-1ygypf7"> </p> <p class="answer-text svelte-1ygypf7"> </p></li>'),ht=k('<ul class="svelte-1ygypf7"></ul>'),pt=k('<p class="no-answers svelte-1ygypf7">No answers for this topic</p>'),bt=k('<div class="result-card svelte-1ygypf7"><h2 class="svelte-1ygypf7"> </h2> <div class="percentage-bar svelte-1ygypf7"><div class="percentage-fill svelte-1ygypf7"></div></div> <p class="percentage-text svelte-1ygypf7"> </p> <p class="points-text svelte-1ygypf7"> </p> <div class="answers-section svelte-1ygypf7"><h3 class="svelte-1ygypf7">Supporting Answers:</h3> <!></div></div>'),wt=k('<div class="results-container svelte-1ygypf7"><h1 class="svelte-1ygypf7"> </h1> <div class="conclusion svelte-1ygypf7"><!></div> <div class="results-grid svelte-1ygypf7"></div> <div class="action-buttons svelte-1ygypf7"><button class="restart-button svelte-1ygypf7">Start Over</button> <button class="share-button svelte-1ygypf7">Share Results</button></div></div>');function St(y,S){we(S,!1);let x=oe(S,"topicResults",28,()=>({})),P=oe(S,"onRestart",8),f=oe(S,"answerHistory",24,()=>[]),p=oe(S,"surveyName",8,"Survey");const j=()=>{const I=Math.max(...Object.values(x()).map(_=>_.count)),b=Object.entries(x()).filter(([_,T])=>T.count===I).map(([_])=>_);let w=`I just completed the "${p()}" survey!

`;b.length===1?w+=`My result: I am most suited for ${b[0]}

`:w+=`My result: I am equally suited for ${b.join(" and ")}

`,w+=`Take the survey yourself: ${window.location.href}`,navigator.share?navigator.share({title:`My ${p()} Results`,text:w,url:window.location.href}).catch(_=>{navigator.clipboard.writeText(w)}):navigator.clipboard.writeText(w)};tt(()=>(ke(x()),ke(f())),()=>{const I=Object.values(x()).reduce((b,w)=>b+w,0);x(Object.entries(x()).reduce((b,[w,_])=>(b[w]={count:_,percentage:I>0?Math.round(_/I*100):0,answers:f().filter(T=>T.topics.includes(w))},b),{}))}),rt(),Se();var E=wt(),n=o(E),t=o(n),a=g(n,2),i=o(a);{var s=I=>{var b=gt();const w=ce(()=>Math.max(...Object.values(x()).map(u=>u.count))),_=ce(()=>Object.entries(x()).filter(([u,c])=>c.count===e(w)).map(([u])=>u));var T=g(te(b),2);{var C=u=>{var c=ft(),q=g(o(c)),X=o(q);K(()=>L(X,e(_)[0])),d(u,c)},Z=u=>{var c=_t(),q=g(o(c));{var X=J=>{var ee=dt(),l=te(ee),v=o(l),h=g(l,2),A=o(h);K(()=>{L(v,e(_)[0]),L(A,e(_)[1])}),d(J,ee)},ve=J=>{var ee=le(),l=te(ee);ue(l,1,()=>e(_),pe,(v,h,A)=>{var U=yt(),N=te(U),R=o(N),Q=g(N);{var z=$=>{var V=ye(",");d($,V)};M(Q,$=>{A<e(_).length-2&&$(z)})}var Y=g(Q);{var B=$=>{var V=ye("and");d($,V)};M(Y,$=>{A===e(_).length-2&&$(B)})}K(()=>L(R,e(h))),d(v,U)}),d(J,ee)};M(q,J=>{e(_).length===2?J(X):J(ve,!1)})}d(u,c)};M(T,u=>{e(_).length===1?u(C):u(Z,!1)})}d(I,b)};M(i,I=>{Object.entries(x()).length>0&&I(s)})}var m=g(a,2);ue(m,5,()=>Object.entries(x()),pe,(I,b)=>{let w=()=>e(b)[0],_=()=>e(b)[1];var T=bt(),C=o(T),Z=o(C),u=g(C,4),c=o(u),q=g(u,2),X=o(q),ve=g(q,2),J=g(o(ve),2);{var ee=v=>{var h=ht();ue(h,5,()=>_().answers,pe,(A,U)=>{var N=mt(),R=o(N),Q=o(R),z=g(R,2),Y=o(z);K(()=>{L(Q,e(U).question),L(Y,`You chose: ${e(U).answer??""}`)}),d(A,N)}),d(v,h)},l=v=>{var h=pt();d(v,h)};M(J,v=>{_().answers.length>0?v(ee):v(l,!1)})}K(()=>{lt(T,"style",`--percentage: ${_().percentage??""}%`),L(Z,w()),L(c,`${_().percentage??""}%`),L(X,`(${_().count??""} points)`)}),d(I,T)});var O=g(m,2),F=o(O),D=g(F,2);K(()=>L(t,`Your Results for "${p()??""}"`)),ne("click",F,function(...I){var b;(b=P())==null||b.apply(this,I)}),ne("click",D,j),d(y,E),xe()}var xt=k('<p class="error-message svelte-1cwy0b0"> </p>'),Rt=k('<div class="user-info-container svelte-1cwy0b0"><h1 class="svelte-1cwy0b0">Almost there!</h1> <p class="svelte-1cwy0b0">Before you see your results for "<strong class="svelte-1cwy0b0"> </strong>", please provide your name and email to save your answers.</p> <form><div class="form-group svelte-1cwy0b0"><label for="userName" class="svelte-1cwy0b0">Name:</label> <input type="text" id="userName" required class="svelte-1cwy0b0"></div> <div class="form-group svelte-1cwy0b0"><label for="userEmail" class="svelte-1cwy0b0">Email:</label> <input type="email" id="userEmail" required class="svelte-1cwy0b0"></div> <!> <button type="submit" class="submit-button svelte-1cwy0b0"><!></button></form></div>');function Pt(y,S){we(S,!1);let x=oe(S,"surveyName",8,"Survey"),P=H(""),f=H(""),p=H(""),j=H(!1);const E=at();function n(c){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(c)}async function t(){if(r(p,""),!e(P).trim()){r(p,"Please enter your name.");return}if(!e(f).trim()){r(p,"Please enter your email address.");return}if(!n(e(f))){r(p,"Please enter a valid email address.");return}r(j,!0);try{E("submitUserInfo",{userName:e(P).trim(),userEmail:e(f).trim()})}catch(c){r(p,"An unexpected error occurred. Please try again."),console.error("Error in UserInfoForm dispatching:",c),r(j,!1)}}Se();var a=Rt(),i=g(o(a),2),s=g(o(i)),m=o(s),O=g(i,2),F=o(O),D=g(o(F),2),I=g(F,2),b=g(o(I),2),w=g(I,2);{var _=c=>{var q=xt(),X=o(q);K(()=>L(X,e(p))),d(c,q)};M(w,c=>{e(p)&&c(_)})}var T=g(w,2),C=o(T);{var Z=c=>{var q=ye("Saving...");d(c,q)},u=c=>{var q=ye("Save and See Results");d(c,q)};M(C,c=>{e(j)?c(Z):c(u,!1)})}K(()=>{L(m,x()),D.disabled=e(j),b.disabled=e(j),T.disabled=e(j)}),Ne(D,()=>e(P),c=>r(P,c)),Ne(b,()=>e(f),c=>r(f,c)),ne("submit",O,it(t)),d(y,a),xe()}var jt=k('<div class="loading-overlay svelte-8jvnkg"><div class="spinner svelte-8jvnkg"></div> Loading...</div>'),It=k('<div class="error-message-bar svelte-8jvnkg"><p> </p> <button class="svelte-8jvnkg">Dismiss</button></div>'),kt=k('<div class="general-message-bar svelte-8jvnkg"><p> </p></div>'),Nt=k('<button class="survey-button svelte-8jvnkg"> </button>'),Et=k('<div class="survey-list svelte-8jvnkg"></div>'),Ot=k("<p>No surveys available. Please add some surveys first.</p>"),qt=k('<div class="survey-selection svelte-8jvnkg"><h2 class="svelte-8jvnkg">Select a Decision Aid</h2> <!></div>'),At=k('<button class="svelte-8jvnkg"> </button>'),Tt=k('<div class="main-content svelte-8jvnkg"><div class="question-container svelte-8jvnkg"><h3 class="svelte-8jvnkg"> </h3> <h2 class="svelte-8jvnkg"> </h2> <div class="button-container svelte-8jvnkg"></div> <div class="progress svelte-8jvnkg"> </div></div></div>'),Dt=k('<div class="no-questions svelte-8jvnkg"><p class="svelte-8jvnkg">There was an issue loading questions for this survey, or the survey is empty.</p> <button class="svelte-8jvnkg">Select Another Survey</button></div>'),Lt=k('<main class="svelte-8jvnkg"><!> <!> <!> <!></main>');function Ft(y,S){we(S,!1);let x=H([]),P=H(null),f=null,p=H([]),j=H(0),E=H(),n=H({}),t=H([]),a=H("selectingSurvey"),i=H(!1),s=H(null),m=H("");st(async()=>{const v=new URLSearchParams(window.location.search).get("survey");if(v)try{await F(v)}catch(h){r(s,"Failed to load the requested survey from URL."),console.error(e(s),h),await O()}else await O()});const O=async()=>{try{r(i,!0),r(s,null),r(x,await vt()),r(a,"selectingSurvey"),r(i,!1)}catch(l){console.error("Error loading surveys:",l),r(s,"Failed to load surveys. Please try again later."),r(i,!1)}},F=async l=>{try{r(i,!0),r(s,null);const v=await ot(l),h=await ut(l);if(!v||!h||h.length===0)throw new Error(`Survey (ID: ${l}) not found or has no questions.`);f=l,r(P,v),r(p,h),r(j,0),r(E,e(p)[e(j)]),r(n,(v.topics||[]).reduce((A,U)=>(A[U]=0,A),{})),r(t,[]),r(a,"takingSurvey"),r(i,!1)}catch(v){throw console.error(`Error loading survey ID ${l}:`,v),r(i,!1),r(a,"selectingSurvey"),v}},D=async l=>{try{await F(l.id);const v=new URL(window.location);v.searchParams.set("survey",l.id),window.history.pushState({},"",v)}catch{r(s,`Failed to load the selected survey (${l.name}). Please try again.`)}},I=(l,v)=>{e(t).push({question:e(E).question,answer:v,topics:l}),l.forEach(h=>{e(n).hasOwnProperty(h)?Ee(n,e(n)[h]++):(console.warn(`Topic "${h}" was selected but not pre-initialized in topicCounters for survey "${e(P).name}". Initializing to 1.`),Ee(n,e(n)[h]=1))}),b()},b=()=>{e(j)<e(p).length-1?(nt(j),r(E,e(p)[e(j)])):r(a,"userInfo")},w=async l=>{const{userName:v,userEmail:h}=l.detail;r(m,"Saving your results..."),r(s,null);let A=-1,U=[];if(e(n)&&Object.keys(e(n)).length>0)for(const R in e(n))e(n).hasOwnProperty(R)&&(e(n)[R]>A?(A=e(n)[R],U=[R]):e(n)[R]===A&&U.push(R));let N="N/A";U.length>0&&(N=U.join(" and "));try{await ct({surveyId:f,surveyName:e(P).name,userName:v,userEmail:h,topicResults:e(n),answerHistory:e(t),finalResult:N}),r(m,"Results saved successfully! Showing your results..."),r(a,"showingResults")}catch(R){console.error("Failed to save submission:",R),r(s,"There was an error saving your results. Please try again or contact support."),r(m,"")}},_=()=>{r(P,null),f=null,r(p,[]),r(j,0),r(E,null),r(t,[]),r(n,{}),r(s,null),r(m,"");const l=new URL(window.location);l.searchParams.delete("survey"),window.history.pushState({},"",l),O()};Se();var T=Lt(),C=o(T);{var Z=l=>{var v=jt();d(l,v)};M(C,l=>{e(i)&&l(Z)})}var u=g(C,2);{var c=l=>{var v=It(),h=o(v),A=o(h),U=g(h,2);K(()=>L(A,e(s))),ne("click",U,()=>r(s,null)),d(l,v)};M(u,l=>{e(s)&&l(c)})}var q=g(u,2);{var X=l=>{var v=kt(),h=o(v),A=o(h);K(()=>L(A,e(m))),d(l,v)};M(q,l=>{e(m)&&e(a)!=="showingResults"&&l(X)})}var ve=g(q,2);{var J=l=>{var v=qt(),h=g(o(v),2);{var A=N=>{var R=Et();ue(R,5,()=>e(x),Q=>Q.id,(Q,z)=>{var Y=Nt(),B=o(Y);K(()=>L(B,e(z).name)),ne("click",Y,()=>D(e(z))),d(Q,Y)}),d(N,R)},U=N=>{var R=le(),Q=te(R);{var z=Y=>{var B=Ot();d(Y,B)};M(Q,Y=>{e(i)||Y(z)},!0)}d(N,R)};M(h,N=>{e(x).length>0?N(A):N(U,!1)})}d(l,v)},ee=l=>{var v=le(),h=te(v);{var A=N=>{var R=Tt(),Q=o(R),z=o(Q),Y=o(z),B=g(z,2),$=o(B),V=g(B,2);ue(V,5,()=>e(E).buttons,W=>W.text+Math.random(),(W,re)=>{var ae=At(),me=o(ae);K(()=>L(me,e(re).text)),ne("click",ae,()=>I(e(re).selectedTopics,e(re).text)),d(W,ae)});var _e=g(V,2),ge=o(_e);K(()=>{L(Y,`Survey: ${e(P).name??""}`),L($,e(E).question),L(ge,`Question ${e(j)+1} of ${e(p).length??""}`)}),d(N,R)},U=N=>{var R=le(),Q=te(R);{var z=B=>{var $=ce(()=>{var V;return(V=e(P))==null?void 0:V.name});Pt(B,{get surveyName(){return e($)},$$events:{submitUserInfo:w}})},Y=B=>{var $=le(),V=te($);{var _e=W=>{var re=ce(()=>{var ae;return(ae=e(P))==null?void 0:ae.name});St(W,{get topicResults(){return e(n)},onRestart:_,get answerHistory(){return e(t)},get surveyName(){return e(re)}})},ge=W=>{var re=le(),ae=te(re);{var me=he=>{var Re=Dt(),Ae=g(o(Re),2);ne("click",Ae,_),d(he,Re)};M(ae,he=>{!e(i)&&e(a)==="takingSurvey"&&(!e(P)||!e(E))&&!e(s)&&he(me)},!0)}d(W,re)};M(V,W=>{e(a)==="showingResults"?W(_e):W(ge,!1)},!0)}d(B,$)};M(Q,B=>{e(a)==="userInfo"?B(z):B(Y,!1)},!0)}d(N,R)};M(h,N=>{e(a)==="takingSurvey"&&e(P)&&e(E)?N(A):N(U,!1)},!0)}d(l,v)};M(ve,l=>{e(a)==="selectingSurvey"?l(J):l(ee,!1)})}d(y,T),xe()}export{Ft as default};
